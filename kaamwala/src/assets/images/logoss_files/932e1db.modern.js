(window.webpackJsonp=window.webpackJsonp||[]).push([[439],{2109:function(e,t,n){"use strict";n.r(t);var r=n(1),d=n(17),l=n.n(d),o=n(149),c=n(180),m=n(15),v=n(379),y=n(54);function h(){return w.apply(this,arguments)}function w(){return w=Object(r.a)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(m.a.debug("Handling UserSignup UTM params"),e>30)throw new Error("Failed to set up user");e++,yield new Promise((e=>setTimeout(e,1e3)));var t=window.$nuxt.$api;if(t){var n={utm_source:l.a.get("utm_source")||"empty",utm_medium:l.a.get("utm_medium")||"(not set)",utm_campaign:l.a.get("utm_campaign")||void 0,currency:l.a.get("currency")||null,language:l.a.get("language")||void 0,cobrand:l.a.get(v.a)||void 0};if(0!==Object.keys(n).length)try{yield t.patch("/api/v3/users/me",n)}catch(t){if(!t.response)throw t;if(404===t.response.status)return h(e)}}})),w.apply(this,arguments)}c.a.$on(o.a.UserSignedIn,(e=>{var t,n,{user:r,method:d,enterprise:v,track_analytics:h=!0}=e;(m.a.debug("Handling UserSignedIn",r),y.c.identify(r.id),y.c.registerGlobalProperties({plan_level:r.plan.package.code}),h&&(y.c.track(y.a.LOGIN,{method:d}),c.a.$emit(o.a.AnalyticsGA4Event,{event:"login",userId:r.id,method:d})),null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser({id:r.id,email:r.email}),v.is_whitelabel)||(l.a.get("currency")!==r.currency&&(l.a.set("currency",r.currency),c.a.$emit(o.a.CurrencyChange,r.currency)),l.a.remove("unauthed_cart"))})),c.a.$on(o.a.UserRegistered,function(){var e=Object(r.a)((function*(e){var t,n,{user:r,method:d,enterprise:v}=e;m.a.debug("Handling UserRegistered",r),y.c.identify(r.id),h().catch((e=>m.a.error(e))),c.a.$emit(o.a.AnalyticsGA4Event,{event:"sign_up",userId:r.id,method:d}),y.c.registerGlobalProperties({plan_level:r.plan.package.code}),y.c.track(y.a.SIGNUP,{method:d,email:r.email}),null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser({id:r.id,email:r.email}),l.a.remove("unauthed_cart")}));return function(t){return e.apply(this,arguments)}}()),c.a.$on(o.a.UserUpdatedAttributes,(e=>{var t,n,{user:r,enterprise:d}=e;m.a.debug("Handling UserUpdatedAttributes",r),l.a.remove("unauthed_cart"),d.is_whitelabel||(r.given_name||r.family_name)&&(null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser({id:r.id,email:r.email}))})),c.a.$on(o.a.UserSignedOut,(e=>{var t,n,{enterprise:r}=e;m.a.debug("Handling UserSignedOut"),null===(t=window.$nuxt)||void 0===t||null===(n=t.$sentry)||void 0===n||n.setUser(null),r.is_whitelabel||(y.c.track(y.a.LOGOUT),y.c.reset())}))}}]);
//# sourceMappingURL=932e1db.modern.js.map